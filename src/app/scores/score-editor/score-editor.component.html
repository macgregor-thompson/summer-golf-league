<h1>Score Editor</h1>

<mat-expansion-panel [disabled]="true" [expanded]="true">
  <!--  <mat-expansion-panel-header>
      This is the expansion title
    </mat-expansion-panel-header>-->
  <mat-panel-description>

  </mat-panel-description>

  <mat-horizontal-stepper [linear]="true" #stepper *ngIf="!showScoreCard"
                          (selectionChange)="onStepperChange($event)">
    <mat-step>
      <ng-template matStepLabel>Week</ng-template>
      <button mat-raised-button color="warn" (click)="openWeekModal()">
        <mat-icon>add</mat-icon>
        Add Week
      </button>
      <mat-form-field>
        <mat-select [(ngModel)]="weekSelected">
          <mat-option *ngFor="let week of weeks" [value]="week">
            Week {{ week.number }} |
            <small>{{ week.date }}</small>
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div class="stepper-buttons">
        <button mat-button color="primary" matStepperNext>Next</button>
      </div>
    </mat-step>
    <mat-step>
      <ng-template matStepLabel>Format</ng-template>
      <mat-form-field>
        <mat-select [(ngModel)]="formatSelected">
          <mat-option [value]="Format.TwoManBetterBall">Two-Man Better Ball</mat-option>
          <mat-option [value]="Format.TwoManAltShot">Two-Man Alt Shot</mat-option>
          <mat-option [value]="Format.TwoManScramble">Two-Man Scramble</mat-option>
          <mat-option [value]="Format.FourManScramble">Four-Man Scramble</mat-option>
        </mat-select>
      </mat-form-field>
      <div class="stepper-buttons">
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button color="primary" matStepperNext>Next</button>
      </div>
    </mat-step>
    <mat-step>
      <ng-template matStepLabel>Course</ng-template>
      <mat-form-field>
        <mat-select [(ngModel)]="courseSelected">
          <mat-option *ngFor="let course of courses" [value]="course">
            {{ course.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div class="stepper-buttons">
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button color="primary" matStepperNext>Next</button>
      </div>
    </mat-step>
    <mat-step>
      <ng-template matStepLabel>Team A</ng-template>
      <mat-form-field>
        <mat-select [(ngModel)]="teamA" placeholder="Team A">
          <mat-option *ngFor="let team of teams" [value]="team">
            <app-team-chip [short]="true" [team]="team"></app-team-chip>
            {{ team.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div *ngIf="teamA">
        <div class="flex-between form-padding">
          <mat-form-field>
            <mat-select [(ngModel)]="match.teamOne.roundA.playerA" placeholder="A Player">
              <mat-option *ngFor="let golfer of (golfers | filterPlayersByTeam : teamA.id)" [value]="golfer">
                {{ golfer.displayName }}
              </mat-option>
            </mat-select>
            <mat-hint align="end" [ngStyle]="{'color': teamColor[teamA.id]}">Team {{teamA.name}}</mat-hint>
          </mat-form-field>
          <mat-form-field *ngIf="formatSelected != Format.TwoManBetterBall">
            <mat-select [(ngModel)]="match.teamOne.roundA.playerB" placeholder="B Player">
              <mat-option *ngFor="let golfer of (golfers | filterPlayersByTeam : teamA.id)" [value]="golfer">
                {{ golfer.displayName }}
              </mat-option>
            </mat-select>
            <mat-hint align="end" [ngStyle]="{'color': teamColor[teamA.id]}">Team {{teamA.name}}</mat-hint>
          </mat-form-field>
          <mat-form-field class="num-input">
            <input matInput type="number" min="0" placeholder="Stack Strokes"
                   (input)="setStrokes(true, 'teamOne', 'roundA', $event)">
          </mat-form-field>
          <mat-form-field class="num-input">
            <input matInput type="number" min="0" placeholder="Match Strokes"
                   (input)="setStrokes(false, 'teamOne', 'roundA', $event)">
          </mat-form-field>
        </div>
        <div class="flex-between form-padding">
          <mat-form-field *ngIf="formatSelected === Format.TwoManBetterBall">
            <mat-select [(ngModel)]="match.teamOne.roundA.playerB" placeholder="B Player">
              <mat-option *ngFor="let golfer of (golfers | filterPlayersByTeam : teamA.id)" [value]="golfer">
                {{ golfer.displayName }}
              </mat-option>
            </mat-select>
            <mat-hint align="end" [ngStyle]="{'color': teamColor[teamA.id]}">Team {{teamA.name}}</mat-hint>
          </mat-form-field>
          <mat-form-field class="num-input">
            <input matInput type="number" min="0" placeholder="Stack Strokes"
                   (input)="setStrokes(true, 'teamOne', 'roundB', $event)">
          </mat-form-field>
          <mat-form-field class="num-input">
            <input matInput type="number" min="0" placeholder="Match Strokes"
                   (input)="setStrokes(false, 'teamOne', 'roundB', $event)">
          </mat-form-field>
        </div>
      </div>
      <div class="stepper-buttons">
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button color="primary" matStepperNext>Next</button>
      </div>
    </mat-step>


    <mat-step>
      <ng-template matStepLabel>Team B</ng-template>
      <mat-form-field>
        <mat-select [(ngModel)]="teamB" placeholder="Team B">
          <mat-option *ngFor="let team of teams" [value]="team">
            <app-team-chip [short]="true" [team]="team"></app-team-chip>
            {{ team.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div *ngIf="teamB">
        <div class="flex-between form-padding">
          <mat-form-field>
            <mat-select [(ngModel)]="match.teamTwo.roundA.playerA" placeholder="A Player">
              <mat-option *ngFor="let golfer of (golfers | filterPlayersByTeam : teamB.id)" [value]="golfer">
                {{ golfer.displayName }}
              </mat-option>
            </mat-select>
            <mat-hint align="end" [ngStyle]="{'color': teamColor[teamB.id]}">Team {{teamB.name}}</mat-hint>
          </mat-form-field>
          <mat-form-field *ngIf="formatSelected != Format.TwoManBetterBall">
            <mat-select [(ngModel)]="match.teamTwo.roundA.playerB" placeholder="B Player">
              <mat-option *ngFor="let golfer of (golfers | filterPlayersByTeam : teamB.id)" [value]="golfer">
                {{ golfer.displayName }}
              </mat-option>
            </mat-select>
            <mat-hint align="end" [ngStyle]="{'color': teamColor[teamB.id]}">Team {{teamB.name}}</mat-hint>
          </mat-form-field>
          <mat-form-field class="num-input">
            <input matInput type="number" min="0" placeholder="Stack Strokes"
                   (input)="setStrokes(true, 'teamTwo', 'roundA', $event)">
          </mat-form-field>
          <mat-form-field class="num-input">
            <input matInput type="number" min="0" placeholder="Match Strokes"
                   (input)="setStrokes(false, 'teamTwo', 'roundA', $event)">
          </mat-form-field>
        </div>
        <div class="flex-between form-padding">
          <mat-form-field *ngIf="formatSelected === Format.TwoManBetterBall">
            <mat-select [(ngModel)]="match.teamTwo.roundB.playerA" placeholder="B Player">
              <mat-option *ngFor="let golfer of (golfers | filterPlayersByTeam : teamB.id)" [value]="golfer">
                {{ golfer.displayName }}
              </mat-option>
            </mat-select>
            <mat-hint align="end" [ngStyle]="{'color': teamColor[teamB.id]}">Team {{teamB.name}}</mat-hint>
          </mat-form-field>
          <mat-form-field class="num-input">
            <input matInput type="number" min="0" placeholder="Stack Strokes"
                   (input)="setStrokes(true, 'teamTwo', 'roundB', $event)">
          </mat-form-field>
          <mat-form-field class="num-input">
            <input matInput type="number" min="0" placeholder="Match Strokes"
                   (input)="setStrokes(false, 'teamTwo', 'roundB', $event)">
          </mat-form-field>
        </div>
      </div>
      <div class="stepper-buttons">
        <button mat-button matStepperPrevious>Back</button>
        <button mat-raised-button color="warn" (click)="this.showScoreCard = true">Add Scores</button>
      </div>
    </mat-step>
  </mat-horizontal-stepper>


  <div class="table-container mat-elevation-z8" *ngIf="showScoreCard">
    <div class="table-responsive">
      <table class="table table-bordered">
        <thead>
        <tr>
          <th class="text-muted">
            <small>Player</small>
          </th>
          <th class="text-muted">
            <small>Stack Strokes</small>
          </th>
          <th class="text-muted">
            <small>Match Strokes</small>
          </th>
          <th class="text-muted" *ngFor="let hole of match.course.holes">
            <small>{{hole.number}}</small>
          </th>
          <th class="text-muted">
            <small>Total</small>
          </th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td class="text-muted">
            <mat-form-field *ngIf="golfers" class="golfer-select">
              <mat-select [value]="match.teamOne?.roundA?.playerA"
                          (change)="onSelectPlayer('teamOne', 'roundA', 'playerA', $event)"
                          placeholder="A Player">
                <mat-option *ngFor="let golfer of (golfers | filterPlayersByTeam : teamA.id)" [value]="golfer">
                  {{ golfer.displayName }}
                </mat-option>
              </mat-select>
              <mat-hint align="end" [ngStyle]="{'color': teamColor[teamA.id]}">Team {{teamA.name}}</mat-hint>
            </mat-form-field>
            <mat-form-field *ngIf="golfers && match.format != Format.TwoManBetterBall" class="golfer-select">
              <mat-select [value]="match.teamOne?.roundA?.playerB"
                          (change)="onSelectPlayer('teamOne', 'roundA', 'playerB', $event)"
                          placeholder="B Player">
                <mat-option *ngFor="let golfer of golfers" [value]="golfer">
                  {{ golfer.displayName }}
                </mat-option>
              </mat-select>
              <mat-hint align="end" [ngStyle]="{'color': teamColor[teamA.id]}">Team {{teamA.name}}</mat-hint>
            </mat-form-field>
          </td>
          <td class="text-center">
            {{match.teamOne.roundA.strokesGetting}}
          </td>
          <td class="text-center">
            {{match.teamOne.roundA.matchStrokes}}
          </td>
          <td *ngFor="let hole of [1,2,3,4,5,6,7,8,9];" class="text-center">
            <mat-form-field class="num-input">
              <input matInput type="number" min="1" placeholder=""
                     (input)="addScorePlayer('teamOne', 'roundA', hole, $event)">
            </mat-form-field>
          </td>
          <td class="total-score-td">
            <span class="total-score-div" [ngStyle]="{'background-color': teamColor[teamA.id]}">
              {{match.teamOne?.roundA?.total}}
            </span>
          </td>
        </tr>
        <tr *ngIf="match.format === Format.TwoManBetterBall">
          <td class="text-muted">
            <mat-form-field *ngIf="golfers" class="golfer-select">
              <mat-select [value]="match.teamOne?.roundB?.playerA"
                          (change)="onSelectPlayer('teamOne', 'roundB', 'playerA', $event)"
                          placeholder="B Player">
                <mat-option *ngFor="let golfer of (golfers | filterPlayersByTeam : teamA.id)" [value]="golfer">
                  {{ golfer.displayName }}
                </mat-option>
              </mat-select>
              <mat-hint align="end" [ngStyle]="{'color': teamColor[teamA.id]}">Team {{teamA.name}}</mat-hint>
            </mat-form-field>
          </td>
          <td class="text-center">
            {{match.teamOne.roundB.strokesGetting}}
          </td>
          <td class="text-center">
            {{match.teamOne.roundB.matchStrokes}}
          </td>
          <td *ngFor="let hole of [1,2,3,4,5,6,7,8,9];" class="text-center">
            <mat-form-field class="num-input">
              <input matInput type="number" min="1" placeholder=""
                     (input)="addScorePlayer('teamOne', 'roundB', hole, $event)">
            </mat-form-field>
          </td>
          <td class="total-score-td">
            <span class="total-score-div" [ngStyle]="{'background-color': teamColor[teamA.id]}">
              {{match.teamOne?.roundB?.total}}
            </span>
          </td>
        </tr>


        <tr *ngIf="golfers">
          <td class="text-muted">
            <mat-form-field class="golfer-select">
              <mat-select [value]="match.teamTwo?.roundA?.playerA"
                          (change)="onSelectPlayer('teamTwo', 'roundA', 'playerA', $event)"
                          placeholder="A Player">
                <mat-option *ngFor="let golfer of (golfers | filterPlayersByTeam : teamB.id)" [value]="golfer">
                  {{ golfer.displayName }}
                </mat-option>
              </mat-select>
              <mat-hint align="end" [ngStyle]="{'color': teamColor[teamB.id]}">Team {{teamB.name}}</mat-hint>
            </mat-form-field>
            <mat-form-field *ngIf="match.format != Format.TwoManBetterBall">
              <mat-select [value]="match.teamTwo?.roundA?.playerB"
                          (change)="onSelectPlayer('teamTwo', 'playerB', $event)"
                          placeholder="B Player">
                <mat-option *ngFor="let golfer of (golfers | filterPlayersByTeam : teamB.id)" [value]="golfer">
                  {{ golfer.displayName }}
                </mat-option>
              </mat-select>
              <mat-hint align="end" [ngStyle]="{'color': teamColor[teamB.id]}">Team {{teamB.name}}</mat-hint>
            </mat-form-field>
          </td>
          <td class="text-center">
            {{match.teamTwo.roundA.strokesGetting}}
          </td>
          <td class="text-center">
            {{match.teamTwo.roundA.matchStrokes}}
          </td>
          <td *ngFor="let hole of [1,2,3,4,5,6,7,8,9];" class="text-center">
            <mat-form-field class="num-input">
              <input matInput type="number" min="1" placeholder=""
                     (input)="addScorePlayer('teamTwo', 'roundA', hole, $event)">
            </mat-form-field>
          </td>
          <td class="total-score-td">
            <span class="total-score-div" [ngStyle]="{'background-color': teamColor[teamB.id]}">
              {{match.teamTwo?.roundA?.total}}
            </span>
          </td>
        </tr>
        <tr *ngIf="match.format === Format.TwoManBetterBall">
          <td class="text-muted">
            <mat-form-field *ngIf="golfers" class="golfer-select">
              <mat-select [value]="match.teamOne?.roundA?.playerB"
                          (change)="onSelectPlayer('teamTwo', 'roundB', 'playerA', $event)"
                          placeholder="B Player">
                <mat-option *ngFor="let golfer of (golfers | filterPlayersByTeam : teamB.id)" [value]="golfer">
                  {{ golfer.displayName }}
                </mat-option>
              </mat-select>
              <mat-hint align="end" [ngStyle]="{'color': teamColor[teamB.id]}">Team {{teamB.name}}</mat-hint>
            </mat-form-field>
          </td>
          <td class="text-center">
            {{match.teamTwo.roundB.strokesGetting}}
          </td>
          <td class="text-center">
            {{match.teamTwo.roundB.matchStrokes}}
          </td>
          <td *ngFor="let hole of [1,2,3,4,5,6,7,8,9];" class="text-center">
            <mat-form-field class="num-input">
              <input matInput type="number" min="1" placeholder=""
                     (input)="addScorePlayer('teamTwo', 'roundB', 'playerA', hole, $event)">
            </mat-form-field>
          </td>
          <td class="total-score-td">
            <span class="total-score-div" [ngStyle]="{'background-color': teamColor[teamB.id]}">
              {{match.teamTwo?.roundB?.total}}
            </span>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</mat-expansion-panel>

